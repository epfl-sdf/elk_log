#!/bin/bash
#petit script Ã  lancer pour que cela tourne !
#zf170808.1735

export LS_HEAP_SIZE="80m"

# Test des arguments
if [ -z "$1" ] ; then
	echo "ERREUR: pas assez d'argument, preciser l'hote"
	exit
else
	echo "changement de l'hote"
	
	if [ "$2" == "louis-1" ] || [ "$2" == "200" ] ; then
		echo "louis-1"
		sed -i "s/^hosts => 'http://.*/hosts => 'http://louis-1:9200'/" wwp_all_grok_final.conf
		curl -XDELETE http://louis-1:9200/wwp_log_20170817
	elif [ "$2" == "guillaume-1" ] || [ "$2" == "198" ] ; then
		echo "guillaume-1"
		sed -i "s/^hosts => 'http://.*/hosts => 'http://guillaume-1:9200'/" wwp_all_grok_final.conf
		curl -XDELETE http://guillaume-1:9200/wwp_log_20170817
	elif [ "$2" == "youssef-1" 
] || [ "$2" == "203" ] ; then
		sed -i "s/^hosts => 'http://.*/hosts => 'http://youssef-1:9200'/" wwp_all_grok_final.conf
		curl -XDELETE http://youssef-1:9200/wwp_log_20170817
	fi
fi

# Test si reset ou non
if [ "$2" == "reset" ] ; then
	echo "reset du template"
	curl -XDELETE http://louis-1:9200/_template/wwp_log_20170817
	curl -XPUT http://louis-1:9200/_template/wwp_log_20170817?pretty -d @wwp_all_grok_mapping.json
else
	echo "pas de reset du template"
fi

/opt/logstash/bin/logstash -f /home/ubuntu/elk_hello_world/wwp_all_grok_final.conf
